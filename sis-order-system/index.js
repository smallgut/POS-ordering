// sis-order-system/index.js
document.addEventListener('DOMContentLoaded', () => {
    // Cart button logic (unchanged)
    const cartButton = document.querySelector('.cart-button');
    if (cartButton) {
        cartButton.addEventListener('click', () => {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            if (cart.length === 0) {
                alert('購物車是空的，請先添加商品！');
            } else {
                alert('前往結帳頁面！');
                window.location.href = 'checkout.html';
            }
        });
    } else {
        console.error('Cart button not found');
    }

    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');
    const confirmButton = document.getElementById('confirmButton');

    // Mapping of goods to their locations (category > subcategory)
    const itemLocations = {
        // ... keep your full mapping here (蔬果類, 鮮肉類, etc.) ...
        '麻糬茄子': ['蔬果類', '蔬菜'],
        '茄子': ['蔬果類', '蔬菜'],
        '芹菜': ['蔬果類', '蔬菜'],
        '西洋芹': ['蔬果類', '蔬菜'],
        '洋蔥 (進口)': ['蔬果類', '蔬菜'],
        '洋蔥(台灣)': ['蔬果類', '蔬菜'],
        '紫洋蔥': ['蔬果類', '蔬菜'],
        '荷蘭豆': ['蔬果類', '蔬菜'],
        '四季豆': ['蔬果類', '蔬菜'],
        '乾豆菜': ['蔬果類', '蔬菜'],
        '扁豆': ['蔬果類', '蔬菜'],
        '敏豆': ['蔬果類', '蔬菜'],
        '醜豆 (粉豆)': ['蔬果類', '蔬菜'],
        '甜豆': ['蔬果類', '蔬菜'],
        '火豆': ['蔬果類', '蔬菜'],
        '長江豆': ['蔬果類', '蔬菜'],
        '紅椒': ['蔬果類', '蔬菜'],
        '黃椒': ['蔬果類', '蔬菜'],
        '青椒': ['蔬果類', '蔬菜'],
        '蕃茄': ['蔬果類', '蔬菜'],
        '牛蕃茄': ['蔬果類', '蔬菜'],
        '青江菜': ['蔬果類', '蔬菜'],
        '蚵白菜': ['蔬果類', '蔬菜'],
        '青豆仁': ['蔬果類', '蔬菜'],
        '大陸妹 (生菜)': ['蔬果類', '蔬菜'],
        '菠菜': ['蔬果類', '蔬菜'],
        '青花菜 (花椰菜)': ['蔬果類', '蔬菜'],
        '白花菜': ['蔬果類', '蔬菜'],
        '青菜': ['蔬果類', '蔬菜'],
        '水蓮': ['蔬果類', '蔬菜'],
        '小松菜': ['蔬果類', '蔬菜'],
        '美生菜': ['蔬果類', '蔬菜'],
        '芥藍菜': ['蔬果類', '蔬菜'],
        '地瓜葉': ['蔬果類', '蔬菜'],
        '羅曼葉': ['蔬果類', '蔬菜'],
        '空心菜': ['蔬果類', '蔬菜'],
        '白菜': ['蔬果類', '蔬菜'],
        '水菜': ['蔬果類', '蔬菜'],
        '玉米筍': ['蔬果類', '蔬菜'],
        '竹筍': ['蔬果類', '蔬菜'],
        '紅菜': ['蔬果類', '蔬菜'],
        '娃娃菜': ['蔬果類', '蔬菜'],
        '龍鬚菜': ['蔬果類', '蔬菜'],
        '高山高麗菜': ['蔬果類', '蔬菜'],
        '梨山高麗菜': ['蔬果類', '蔬菜'],
        '高麗菜': ['蔬果類', '蔬菜'],
        '紫高麗': ['蔬果類', '蔬菜'],
        '山東白菜': ['蔬果類', '蔬菜'],
        '小豆苗': ['蔬果類', '蔬菜'],
        '韭菜': ['蔬果類', '蔬菜'],
        '蘆筍 (進口)': ['蔬果類', '蔬菜'],
        '蘆筍 (台灣)': ['蔬果類', '蔬菜'],
        '埔里晈白筍': ['蔬果類', '蔬菜'],
        '筊白筍': ['蔬果類', '蔬菜'],
        '新鮮百合': ['蔬果類', '蔬菜'],
        '秋葵': ['蔬果類', '蔬菜'],
        // Fruits from veg.html
        '檸檬': ['蔬果類', '水果'],
        '柳丁': ['蔬果類', '水果'],
        '香蕉': ['蔬果類', '水果'],
        '蘋果': ['蔬果類', '水果'],
        '金桔': ['蔬果類', '水果'],
        '鳳梨': ['蔬果類', '水果'],
        '木瓜': ['蔬果類', '水果'],
        '奇異果': ['蔬果類', '水果'],
        '芭樂': ['蔬果類', '水果'],
        '葡萄柚': ['蔬果類', '水果'],
        '巨峰葡萄': ['蔬果類', '水果'],
        '小玉西瓜': ['蔬果類', '水果'],
        '西瓜': ['蔬果類', '水果'],
        // Mushrooms from veg.html
        '香菇': ['蔬果類', '菇類'],
        '杏鮑菇': ['蔬果類', '菇類'],
        '鴻禧菇': ['蔬果類', '菇類'],
        '秀珍菇': ['蔬果類', '菇類'],
        '金針菇': ['蔬果類', '菇類'],
        '白精靈菇': ['蔬果類', '菇類'],
        '美白菇': ['蔬果類', '菇類'],
        '磨菇': ['蔬果類', '菇類'],
        // Seasonings from veg.html
        '薑': ['蔬果類', '配料類'],
        '老薑': ['蔬果類', '配料類'],
        '嫩薑': ['蔬果類', '配料類'],
        '薑絲': ['蔬果類', '配料類'],
        '蒜頭': ['蔬果類', '配料類'],
        '蒜仁': ['蔬果類', '配料類'],
        '蒜末': ['蔬果類', '配料類'],
        '蒜中': ['蔬果類', '配料類'],
        '蒜泥 (蒜膏)': ['蔬果類', '配料類'],
        '蒜碎': ['蔬果類', '配料類'],
        '蒜苗': ['蔬果類', '配料類'],
        '蒜頭仁': ['蔬果類', '配料類'],
        '蒜': ['蔬果類', '配料類'],
        '朝天椒': ['蔬果類', '配料類'],
        '辣椒': ['蔬果類', '配料類'],
        '辣椒絲': ['蔬果類', '配料類'],
        '綠辣椒': ['蔬果類', '配料類'],
        '小辣椒': ['蔬果類', '配料類'],
        '大辣椒': ['蔬果類', '配料類'],
        '香菜 (巴西利)': ['蔬果類', '配料類'],
        '九層塔': ['蔬果類', '配料類'],
        '蔥': ['蔬果類', '配料類'],
        '蔥花': ['蔬果類', '配料類'],
        '木耳': ['蔬果類', '配料類'],
        '木耳片': ['蔬果類', '配料類'],
        '海茸 (海龍)': ['蔬果類', '配料類'],
        '打結海帶 (海帶結)': ['蔬果類', '配料類'],
        '海帶絲': ['蔬果類', '配料類'],
        '海帶串 (海帶卷)': ['蔬果類', '配料類'],
        '豆芽 (銀芽)': ['蔬果類', '配料類'],
        '苜蓿芽': ['蔬果類', '配料類'],
        '酸菜': ['蔬果類', '配料類'],
        '熟白芝麻': ['蔬果類', '配料類'],
        '紅棗': ['蔬果類', '配料類'],
        '枸杞': ['蔬果類', '配料類'],
        '山藥': ['蔬果類', '配料類'],
        '牛蒡': ['蔬果類', '配料類'],
        '牛蒡絲': ['蔬果類', '配料類'],
        '蓮子': ['蔬果類', '配料類'],
        '山葵 (哇沙米)': ['蔬果類', '配料類'],
        // Root Vegetables from veg.html
        '馬鈴薯 (馬K)': ['蔬果類', '根莖類'],
        '刈薯': ['蔬果類', '根莖類'],
        '甜薯': ['蔬果類', '根莖類'],
        '紅蘿蔔 (紅K)': ['蔬果類', '根莖類'],
        '紅蘿蔔絲 (紅K絲)': ['蔬果類', '根莖類'],
        '白蘿蔔 (白K)': ['蔬果類', '根莖類'],
        '日本山藥': ['蔬果類', '根莖類'],
        '山藥': ['蔬果類', '根莖類'],
        '地瓜': ['蔬果類', '根莖類'],
        '小條地瓜': ['蔬果類', '根莖類'],
        '芋頭': ['蔬果類', '根莖類'],
        '紅地瓜': ['蔬果類', '根莖類'],
        '馬蹄': ['蔬果類', '根莖類'],
        '蓮藕': ['蔬果類', '根莖類'],
        // Melons from veg.html
        '小黃瓜': ['蔬果類', '瓜類'],
        '青苦瓜': ['蔬果類', '瓜類'],
        '白苦瓜': ['蔬果類', '瓜類'],
        '山苦瓜': ['蔬果類', '瓜類'],
        '絲瓜': ['蔬果類', '瓜類'],
        '大黃瓜': ['蔬果類', '瓜類'],
        '青木瓜': ['蔬果類', '瓜類'],
        '菜瓜': ['蔬果類', '瓜類'],
        '佛手瓜': ['蔬果類', '瓜類'],
        '絝瓜 (蒲仔)': ['蔬果類', '瓜類'],
        // Meat from meat.html
        '紅燒肉': ['鮮肉類', '豬牛羊'],
        '羊肉片': ['鮮肉類', '豬牛羊'],
        '鹹牛肉': ['鮮肉類', '豬牛羊'],
        '牛柳': ['鮮肉類', '豬牛羊'],
        '鹹豬肉': ['鮮肉類', '豬牛羊'],
        '三層肉': ['鮮肉類', '豬牛羊'],
        '豬絞肉': ['鮮肉類', '豬牛羊'],
        '培根': ['鮮肉類', '豬牛羊'],
        '軟排': ['鮮肉類', '豬牛羊'],
        '腩排': ['鮮肉類', '豬牛羊'],
        '豬柳': ['鮮肉類', '豬牛羊'],
        '豬頭皮': ['鮮肉類', '豬牛羊'],
        '豬耳朵': ['鮮肉類', '豬牛羊'],
        '豬心': ['鮮肉類', '豬牛羊'],
        // Poultry from meat.html
        '茶雞': ['鮮肉類', '雞鴨鵝/其他'],
        '雞翅': ['鮮肉類', '雞鴨鵝/其他'],
        '雞頭骨': ['鮮肉類', '雞鴨鵝/其他'],
        '油雞腿': ['鮮肉類', '雞鴨鵝/其他'],
        '雞胸清肉': ['鮮肉類', '雞鴨鵝/其他'],
        '雞腿腿肉': ['鮮肉類', '雞鴨鵝/其他'],
        '雞腿': ['鮮肉類', '雞鴨鵝/其他'],
        '鳳爪 (白)': ['鮮肉類', '雞鴨鵝/其他'],
        '鳳爪 (黑)': ['鮮肉類', '雞鴨鵝/其他'],
        '烤鴨': ['鮮肉類', '雞鴨鵝/其他'],
        '生鴨頭': ['鮮肉類', '雞鴨鵝/其他'],
        '煙燻鳳爪': ['鮮肉類', '雞鴨鵝/其他'],
        '田雞': ['鮮肉類', '雞鴨鵝/其他'],
        // Seafood from seafood.html
        '蚵仔': ['海鮮類', '海鮮類'],
        '蝦米 (金鉤蝦)': ['海鮮類', '海鮮類'],
        '鮭魚片': ['海鮮類', '海鮮類'],
        '小魚干': ['海鮮類', '海鮮類'],
        '小石斑': ['海鮮類', '海鮮類'],
        '軟絲': ['海鮮類', '海鮮類'],
        '蛤仔 (蛤蜊)': ['海鮮類', '海鮮類'],
        '圓鱈': ['海鮮類', '海鮮類'],
        '鯛魚片': ['海鮮類', '海鮮類'],
        '小鯧魚': ['海鮮類', '海鮮類'],
        // Cooked Food from others.html
        '肉羹': ['其他類', '冷凍食品火鍋'],
        '三色蛋': ['其他類', '冷凍食品火鍋'],
        '甜不辣片': ['其他類', '冷凍食品火鍋'],
        '甜不辣條': ['其他類', '冷凍食品火鍋'],
        '米血糕': ['其他類', '冷凍食品火鍋'],
        '鴨血': ['其他類', '冷凍食品火鍋'],
        '素獅子頭': ['其他類', '冷凍食品火鍋'],
        '糯米腸': ['其他類', '冷凍食品火鍋'],
        '士林大香腸': ['其他類', '冷凍食品火鍋'],
        '蒜味香腸': ['其他類', '冷凍食品火鍋'],
        '雞米花': ['其他類', '冷凍食品火鍋'],
        '芋籤': ['其他類', '冷凍食品火鍋'],
        '洪牌豬血糕': ['其他類', '冷凍食品火鍋'],
        '白魚丸': ['其他類', '冷凍食品火鍋'],
        '花枝丸': ['其他類', '冷凍食品火鍋'],
        '鱈魚丸': ['其他類', '冷凍食品火鍋'],
        '新竹貢丸': ['其他類', '冷凍食品火鍋'],
        '大貢丸': ['其他類', '冷凍食品火鍋'],
        '福茂大貢丸': ['其他類', '冷凍食品火鍋'],
        '福茂小貢丸': ['其他類', '冷凍食品火鍋'],
        '香菇貢丸': ['其他類', '冷凍食品火鍋'],
        '素丸': ['其他類', '冷凍食品火鍋'],
        '肉焿': ['其他類', '冷凍食品火鍋'],
        '魷魚焿': ['其他類', '冷凍食品火鍋'],
        '餛飩': ['其他類', '冷凍食品火鍋'],
        '蝦餃': ['其他類', '冷凍食品火鍋'],
        '魚餃': ['其他類', '冷凍食品火鍋'],
        '燕餃': ['其他類', '冷凍食品火鍋'],
        '蛋餃': ['其他類', '冷凍食品火鍋'],
        '鴨肉丸': ['其他類', '冷凍食品火鍋'],
        '羊肉丸': ['其他類', '冷凍食品火鍋'],
        '綜合火鍋料': ['其他類', '冷凍食品火鍋'],
        '標太郎水餃': ['其他類', '冷凍食品火鍋'],
        // Processed Food from others.html
        
        '純瑪琳': ['其他類', '加工食品'],
        '玉米粒': ['其他類', '加工食品'],
        '大茂黑瓜': ['其他類', '加工食品'],
        '番茄鲭魚': ['其他類', '加工食品'],
        '鳗魚缶頭': ['其他類', '加工食品'],
        '土豆麵筋': ['其他類', '加工食品'],
        '辣筍絲': ['其他類', '加工食品'],
        '脆筍絲': ['其他類', '加工食品'],
        '月亮蝦餅': ['其他類', '加工食品'],
        '薯條': ['其他類', '加工食品'],
        '山藥卷': ['其他類', '加工食品'],
        '海鮮卷': ['其他類', '加工食品'],
        '蕎麥卷': ['其他類', '加工食品'],
        '春捲皮': ['其他類', '加工食品'],
        '泡菜': ['其他類', '加工食品'],
        '肉鬆': ['其他類', '加工食品'],
        '素肉鬆': ['其他類', '加工食品'],
        
        // Tofu and Noodles from others.html
        '豆漿': ['其他類', '豆麵類'],
        '豆乾 (豆干)': ['其他類', '豆麵類'],
        '豆乾角 (豆干角)': ['其他類', '豆麵類'],
        '四角油豆腐': ['其他類', '豆麵類'],
        '中華豆腐 (超嫩)': ['其他類', '豆麵類'],
        '中華豆腐 (家常)': ['其他類', '豆麵類'],
        '中華豆腐 (雞蛋)': ['其他類', '豆麵類'],
        '中華豆花 (花生)': ['其他類', '豆麵類'],
        '板豆腐': ['其他類', '豆麵類'],
        '雞蛋豆腐': ['其他類', '豆麵類'],
        '臭豆腐': ['其他類', '豆麵類'],
        '五香豆乾': ['其他類', '豆麵類'],
        '豆乾絲': ['其他類', '豆麵類'],
        '油豆腐': ['其他類', '豆麵類'],
        '豆皮': ['其他類', '豆麵類'],
        '白豆乾': ['其他類', '豆麵類'],
        '炸豆皮': ['其他類', '豆麵類'],
        '豆腐': ['其他類', '豆麵類'],
        '芙蓉豆腐': ['其他類', '豆麵類'],
        '豬肉絲': ['其他類', '豆麵類'],
        '麵': ['其他類', '豆麵類'],
        '麵腸': ['其他類', '豆麵類'],
        '涼麵': ['其他類', '豆麵類'],
        '油麵': ['其他類', '豆麵類'],
        '意麵': ['其他類', '豆麵類'],
        '陽春麵': ['其他類', '豆麵類'],
        '新竹米粉': ['其他類', '豆麵類'],
        '板條': ['其他類', '豆麵類'],
        '餛飩皮': ['其他類', '豆麵類'],
        // Others from others.html
        '台灣啤酒 330ml': ['其他類', '其他'],
        '可口可樂 330ml': ['其他類', '其他'],
        '礦泉水': ['其他類', '其他'],
        '紅標米酒': ['其他類', '其他'],
        '生活綠茶': ['其他類', '其他'],
        '生活紅茶': ['其他類', '其他'],
        '烏醋': ['其他類', '其他'],
        '岡山辣豆瓣酱': ['其他類', '其他'],
        '紅蔥油': ['其他類', '其他'],
        '蒜花生': ['其他類', '其他'],
        '牛奶花生': ['其他類', '其他'],
        '白大蛋': ['其他類', '其他'],
        '皮蛋': ['其他類', '其他'],
        '鹹蛋': ['其他類', '其他'],
        '滷蛋': ['其他類', '其他'],
        '鳥蛋': ['其他類', '其他'],
        '鹼粽': ['其他類', '其他'],
        '碎菜脯': ['其他類', '其他'],
        '蝦皮': ['其他類', '其他'],
        '沙拉': ['其他類', '其他'],
        '杏仁粉粿': ['其他類', '其他'],
        '仙草': ['其他類', '其他'],
        '珍珠圓': ['其他類', '其他'],
        '椰子絲': ['其他類', '其他'],
        '愛玉': ['其他類', '其他'],
        '紫蘇梅': ['其他類', '其他'],
        '香椿醬': ['其他類', '其他'],
        '黑胡椒醬': ['其他類', '其他'],
        '龜甲萬醬油 (商業)': ['其他類', '其他'],
        '牛頭牌沙茶醬': ['其他類', '其他'],
        '辣椒醬': ['其他類', '其他'],
        '哈合辣豆瓣醬': ['其他類', '其他'],
        '味滋康和風醬': ['其他類', '其他'],
        '味噌': ['其他類', '其他'],
        '台糖白砂糖': ['其他類', '其他'],
        '海味味精': ['其他類', '其他'],
        '鹽巴': ['其他類', '其他'],
        '太白粉': ['其他類', '其他'],
        // ...
    };

    confirmButton.addEventListener('click', () => {
        const query = searchInput.value.trim().toLowerCase();
        searchResults.innerHTML = '';

        if (!query) {
            searchResults.textContent = '請輸入商品名稱！';
            searchResults.className = 'text-red-500';
            return;
        }

        const matches = Object.keys(itemLocations).filter(item =>
            item.toLowerCase().includes(query)
        );

        if (matches.length > 0) {
            matches.forEach(item => {
                const [category, subcategory] = itemLocations[item];
                const result = document.createElement('div');
                result.textContent = `${item} 位於 ${category} 中的 ${subcategory}`;
                result.className = 'py-1 text-white cursor-pointer hover:bg-gray-700';

                // Make result clickable
                result.addEventListener('click', () => {
                    // Store in localStorage for target page
                    localStorage.setItem('selectedCategory', category);
                    localStorage.setItem('selectedSubcategory', subcategory);
                    localStorage.setItem('selectedItem', item);

                    // Redirect based on category
                    switch (category) {
                        case '蔬果類':
                            window.location.href = 'veg.html';
                            break;
                        case '鮮肉類':
                            window.location.href = 'meat.html';
                            break;
                        case '海鮮類':
                            window.location.href = 'seafood.html';
                            break;
                        case '其他類':
                            window.location.href = 'others.html';
                            break;
                        default:
                            alert('未知的類別');
                    }
                });

                searchResults.appendChild(result);
            });
        } else {
            searchResults.textContent = '未找到相關商品！';
            searchResults.className = 'text-red-500';
        }
    });
});
